================================================================================
Script 04: Environment-Specific Fits & Z-Scores
  TEST MODE: Processing small subset only
================================================================================

Loading data...
  ⚠ Could not load Parquet: [Errno 2] No such file or directory: '/n/scratch/users/b/byc014/github/bac_genome_constraint/results/4_statistical_analyses/02_env_cohorts/master_table_env_filtered.parquet'
    Trying TSV format...
  ✓ Loaded 2164 genomes from TSV
  ✓ Loaded 330 global scaling parameters
  ✓ Loaded 8 valid environments
  TEST MODE: Using 5 environments and 10 GO categories

A. Fitting Per-Environment Scaling Laws
--------------------------------------------------------------------------------
  Aquatic: 10 / 10 categories fitted
  Terrestrial: 10 / 10 categories fitted
  Mammals: Human: 10 / 10 categories fitted
  Plants: 10 / 10 categories fitted
  Mammals: 10 / 10 categories fitted

  Total env×category fits: 50 / 50
  Skipped due to low sample size (<10): 0
  Skipped due to low variance: 0

B. Computing Z-Scores
--------------------------------------------------------------------------------
  ⚠ Z-score undefined for Aquatic×0000179: SE=0 (alpha)
  ⚠ Z-score undefined for Aquatic×0000179: SE=0 (beta)
  ⚠ Skipping Aquatic×0000179: invalid Z (alpha=nan, beta=nan, alpha_se=0.000000, beta_se=0.000000)
  ⚠ Z-score undefined for Aquatic×0000311: SE=0 (alpha)
  ⚠ Z-score undefined for Aquatic×0000311: SE=0 (beta)
  ⚠ Skipping Aquatic×0000311: invalid Z (alpha=nan, beta=nan, alpha_se=0.000000, beta_se=0.000000)
  ⚠ Z-score undefined for Terrestrial×0000179: SE=0 (alpha)
  ⚠ Z-score undefined for Terrestrial×0000179: SE=0 (beta)
  ⚠ Skipping Terrestrial×0000179: invalid Z (alpha=nan, beta=nan, alpha_se=0.000000, beta_se=0.000000)
  ⚠ Z-score undefined for Mammals: Human×0000179: SE=0 (alpha)
  ⚠ Z-score undefined for Mammals: Human×0000179: SE=0 (beta)
  ⚠ Skipping Mammals: Human×0000179: invalid Z (alpha=nan, beta=nan, alpha_se=0.000000, beta_se=0.000000)
  ⚠ Z-score undefined for Mammals: Human×0000311: SE=0 (alpha)
  ⚠ Z-score undefined for Mammals: Human×0000311: SE=0 (beta)
  ⚠ Skipping Mammals: Human×0000311: invalid Z (alpha=nan, beta=nan, alpha_se=0.000000, beta_se=0.000000)
  ⚠ Z-score undefined for Plants×0000179: SE=0 (alpha)
  ⚠ Z-score undefined for Plants×0000179: SE=0 (beta)
  ⚠ Z-score undefined for Plants×0000311: SE=0 (alpha)
  ⚠ Z-score undefined for Plants×0000311: SE=0 (beta)
  ⚠ Z-score undefined for Mammals×0000179: SE=0 (alpha)
  ⚠ Z-score undefined for Mammals×0000179: SE=0 (beta)
  ⚠ Z-score undefined for Mammals×0000311: SE=0 (alpha)
  ⚠ Z-score undefined for Mammals×0000311: SE=0 (beta)
  Computed 41 valid Z-scores

C. Category-Level Aggregation
--------------------------------------------------------------------------------
  Aggregated Z-scores for 8 categories
  Z_alpha_category: min=1.5892, median=2.4550, max=3.1658
  Z_beta_category: min=1.5757, median=2.3442, max=3.1246
  ⚠ 6 categories with Z_alpha_category > 2
  ⚠ 6 categories with Z_beta_category > 2

  Top 10 categories by Z_alpha_category:
    0000160: Z_alpha=3.1658, n_envs=5
    0000049: Z_alpha=2.6102, n_envs=5
    0000156: Z_alpha=2.5927, n_envs=5
    0000287: Z_alpha=2.5877, n_envs=5
    0000166: Z_alpha=2.3223, n_envs=5
    0000271: Z_alpha=2.1160, n_envs=5
    0000015: Z_alpha=1.9646, n_envs=5
    0000155: Z_alpha=1.5892, n_envs=5

  Top 10 categories by Z_beta_category:
    0000160: Z_beta=3.1246, n_envs=5
    0000049: Z_beta=2.6435, n_envs=5
    0000287: Z_beta=2.5371, n_envs=5
    0000156: Z_beta=2.4742, n_envs=5
    0000166: Z_beta=2.2142, n_envs=5
    0000271: Z_beta=2.0915, n_envs=5
    0000015: Z_beta=1.9389, n_envs=5
    0000155: Z_beta=1.5757, n_envs=5

D. Writing Outputs
--------------------------------------------------------------------------------
  ✓ env_scaling_params_test.tsv: 50 env×category fits
  ✓ env_vs_global_Z_scores_test.tsv: 41 env×category Z-scores
  ✓ category_Z_summary_test.tsv: 8 categories