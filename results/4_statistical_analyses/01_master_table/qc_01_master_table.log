================================================================================
Script 01: Build Master Table
================================================================================

A. Input Validation
--------------------------------------------------------------------------------
Loading GO counts table...
  ✓ File loaded successfully
  Number of genomes with GO data: 3088
  Number of GO categories: 334
  ✓ All GO columns are numeric
  ✓ All GO values are >= 0
  ✓ Index contains unique genome identifiers

Loading feature matrix...
  ✓ File loaded successfully
  Number of genomes in feature matrix: 3101
  ✓ All required columns present
  ✓ genes_total is integer type
  Number of genomes with genes_total > 0: 3101 / 3101
  Missing data summary:
    checkm_completeness: 1 NaN, 0 empty strings
    checkm_contamination: 363 NaN, 0 empty strings

B. Join Integrity Checks
--------------------------------------------------------------------------------
Joining GO counts with feature matrix...
  GO counts index name: Genome
  Feature matrix accession column: accession
  Expected ≈3088 rows (all GO genomes)
  Actual: 3088 rows
  Difference: 0 genomes
  ✓ Join size within expected range
  ✓ No duplicate accessions after join
  Missing environments: 0 NaN, 0 empty, 101 'Unclassified'

C. QC Filtering
--------------------------------------------------------------------------------
  Starting with 3088 genomes
  Completeness filter (>90):
    NaN values treated as 0: 1
    Lost: 259 genomes
  Contamination filter (<5):
    NaN values treated as 100: 353
    Lost: 543 genomes
  Genes filter (>0): Lost 0 genomes
  Environment filter (not null/empty/'Unclassified'):
    Lost: 77 genomes (0 null, 0 empty, 77 'Unclassified')
  Total retained: 2209 genomes
  Total lost: 879 genomes

D. Environment-Level Sanity Checks
--------------------------------------------------------------------------------
  Environment counts (sorted by genome count):
    Aquatic: 598 genomes
    Terrestrial: 479 genomes
    Mammals: Human: 406 genomes
    Plants: 281 genomes
    Mammals: 198 genomes
    Food production: 103 genomes
    Wastewater: 63 genomes
    Birds: 36 genomes
    Algae: 16 genomes
    Bioreactor: 15 genomes
    Solid waste: 14 genomes

E. Writing Outputs
--------------------------------------------------------------------------------
  ✓ master_table_raw.tsv: 3088 rows
  ✓ master_table_high_quality.tsv: 2209 rows
  ✓ environment_counts_all.tsv: 11 environments